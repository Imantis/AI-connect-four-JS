$(document).ready(function(){let c="player";const l=6,u=7;let v;var i=[],f=[];function d(a,e){let t=0,r=!1,l=$("."+a);return i.forEach(e=>{if(e.forEach(e=>f[e]!==a?(t=0,null):void t++),4<=t)return r=!0,null}),r&&"future"!==e&&(l.first().hasClass("active-player")?alert("Player win!"):l.first().hasClass("active-ai")&&alert("AI win!"),$(".element").addClass("active")),r}function p(e){let a=e.data("element"),t=e,r;if(a>=l*u-l)return t;for(;a<=u*l;)if(a+=u,r=t,t=$("[data-element="+a+"]"),!t.length||t.hasClass("active"))return r;return"Error"}function a(){var e=function(){console.log("Turn status on start "+c);let e=[],a,t,r,l=$.extend(!0,{},c);var i=JSON.parse(JSON.stringify(f));let s=[];s=function(e){let a,t,r;for(a=1;a<=u;a++)if(!$("[data-element="+a+"]").hasClass("active"))for(e["lev_1_turn_"+a]={value:a,weight:null,turn_combination:[a],lev:1},t=1;t<=u;t++)for($("[data-element="+t+"]").hasClass("active")||(e["lev_2_turn_"+a+"_"+t]={value:a,weight:null,turn_combination:[a,t],lev:2}),r=1;r<=u;r++)$("[data-element="+r+"]").hasClass("active")||(e["lev_3_turn_"+a+"_"+t+"_"+r]={value:a,weight:null,turn_combination:[a,t,r],lev:3});return e}(s);let n,o;for(n in s)o=s[n],c=$.extend(!0,{},l),f=JSON.parse(JSON.stringify(i)),o.turn_combination.forEach(e=>{v=p($("[data-element="+e+"]")),"Error"===v||(a=!1,t=!1,c="player"===c?(f[v.attr("data-element")]="active-player",a=d("active-player","future"),"ai"):(f[v.attr("data-element")]="active-ai",t=d("active-ai","future"),"player"),r=!0===t?1:!0===a?-1:0,s[n].weight=r)});c=$.extend(!0,{},l),f=i,console.log(f),console.log(s);for(n in s)if(o=s[n],1===o.lev&&1===o.weight){e=o.turn_combination;break}return e[0]?(console.log("AI MOVE!"),e[0]):3}();v=p($("[data-element="+e+"]")),"Error"===v?alert(v):(v.addClass("active-ai").addClass("active"),c="player",d(f[v.attr("data-element")]="active-ai"))}!function(){let e,a;for(e=0;e<l;e++)a=e*u,i.push([a+1,a+2,a+3,a+4]),i.push([a+2,a+3,a+4,a+5]),i.push([a+3,a+4,a+5,a+6]),i.push([a+4,a+5,a+6,a+7]);for(e=1;e<=u;e++)a=e,i.push([a,a+u,a+2*u,a+3*u]),i.push([a+u,a+2*u,a+3*u,a+4*u]),i.push([a+2*u,a+3*u,a+4*u,a+5*u]);for(e=1;e<=u-3;e++)a=e,i.push([a,a+(u+1),a+(2*u+2),a+(3*u+3)]),i.push([a+u,a+(2*u+1),a+(3*u+2),a+(4*u+3)]),i.push([a+2*u,a+(3*u+1),a+(4*u+2),a+(5*u+3)]);for(e=4;e<=u;e++)a=e,i.push([a,a+(u-1),a+(2*u-2),a+(3*u-3)]),i.push([a+u,a+(2*u-1),a+(3*u-2),a+(4*u-3)]),i.push([a+2*u,a+(3*u-1),a+(4*u-2),a+(5*u-3)]);console.log(i)}(),$(".element").each(function(e){$(this).attr("data-element",e+1),$(this).append(e+1),f[e+1]="empty"}),$("[data-restart-game-first-player]").click(function(){alert("Game restarted. First player step!"),c="player",$(".active").removeClass("active-player").removeClass("active-ai").removeClass("active")}),$("[data-restart-game-first-ai]").click(function(){alert("Game restarted. First AI step!"),c="ai",$(".active").removeClass("active-player").removeClass("active-ai").removeClass("active"),a()}),$(".element").click(function(){if(!$(this).hasClass("active")){let e=!1;"player"===c?(v=p($(this)),"Error"===v?alert(v):(v.addClass("active-player").addClass("active"),f[v.attr("data-element")]="active-player",c="ai",e=d("active-player")),e||a()):(v=p($(this)),"error"===v?alert("Error"):(v.addClass("active-ai").addClass("active"),f[v.attr("data-element")]="active-ai",c="player",d("active-ai")))}})});