$(document).ready(function(){let l="player";const o=6,s=7;let c;var n=[],u=[];function f(t,e){let a=0,r=!1,i=$("."+t);return n.forEach(e=>{if(e.forEach(e=>u[e]!==t?(a=0,null):void a++),4<=a)return r=!0,null}),r&&"future"!==e&&(i.first().hasClass("active-player")?alert("Player win!"):i.first().hasClass("active-ai")&&alert("AI win!"),$(".element").addClass("active")),r}function t(e){let t=e.data("element"),a=e,r;if(t>=o*s-o)return a;for(;t<=s*o;)if(t+=s,r=a,a=$("[data-element="+t+"]"),!a.length||a.hasClass("active"))return r;return"Error"}function a(){var e=function(){console.log("Turn status on start "+l);var e=[];e=function(e){let t,a,r,i,n,l;for(t=1;t<=s;t++)if("empty"===u[t]&&(n=0,l=[t],n=p(l),e["turn_"+t]={weight:n,turn_combination:l,lev:1},0===n))for(a=1;a<=s;a++)if("empty"===u[a]&&(n=0,l=[t,a],n=p(l),e["turn_"+t+"_"+a]={weight:n,turn_combination:l,lev:2},0===n))for(r=1;r<=s;r++)if("empty"===u[r]&&(n=0,l=[t,a,r],n=p(l),e["turn_"+t+"_"+a+"_"+r]={weight:n,turn_combination:l,lev:3},0===n))for(i=1;i<=s;i++)"empty"===u[i]&&(n=0,l=[t,a,r,i],n=p(l),e["turn_"+t+"_"+a+"_"+r+"_"+i]={weight:n,turn_combination:l,lev:4});return e}(e);let t,a,r=0;for(t in console.log(u),console.log(e),e=i(2,e),e=i(1,e),console.log(e),e)a=e[t],1===a.lev&&1===a.weight&&(r=a.turn_combination[0]);if(0===r)for(t in e)a=e[t],1===a.lev&&0===a.weight&&(r=a.turn_combination[0]);if(0===r)for(t in e)a=e[t],1===a.lev&&-1===a.weight&&(r=a.turn_combination[0]);0===r&&(r=1);return r}();c=t($("[data-element="+e+"]")),"Error"===c?alert(c):(c.addClass("active-ai").addClass("active"),l="player",f(u[c.attr("data-element")]="active-ai"))}function p(e){var t=$.extend(!0,{},l),a=JSON.parse(JSON.stringify(u));let r,i,n=0;return e.forEach(e=>{c=function(e){let t=e,a;if(t>=o*s-o)return t;for(;t<=s*o;)if(a=t,t+=s,"active-ai"===u[t]||"active-player"===u[t]||void 0===u[t])return a;return"Error"}(e),"Error"===c||(r=!1,i=!1,l="player"===l?(u[c]="active-player",r=f("active-player","future"),"ai"):(u[c]="active-ai",i=f("active-ai","future"),"player"),n=!0===i?1:!0===r?-1:0)}),l=$.extend(!0,{},t),u=a,n}function i(t,a){let r,i,n;var l;for(r in a){let e=[];if(i=a[r],i.lev===t&&0===i.weight){for(n=1;n<=s;n++)e.push(a[r+"_"+n].weight);a[r].weight=t%2?(l=e,Math.max.apply(null,l)):(l=e,Math.min.apply(null,l))}}return a}!function(){let e,t;for(e=0;e<o;e++)t=e*s,n.push([t+1,t+2,t+3,t+4]),n.push([t+2,t+3,t+4,t+5]),n.push([t+3,t+4,t+5,t+6]),n.push([t+4,t+5,t+6,t+7]);for(e=1;e<=s;e++)t=e,n.push([t,t+s,t+2*s,t+3*s]),n.push([t+s,t+2*s,t+3*s,t+4*s]),n.push([t+2*s,t+3*s,t+4*s,t+5*s]);for(e=1;e<=s-3;e++)t=e,n.push([t,t+(s+1),t+(2*s+2),t+(3*s+3)]),n.push([t+s,t+(2*s+1),t+(3*s+2),t+(4*s+3)]),n.push([t+2*s,t+(3*s+1),t+(4*s+2),t+(5*s+3)]);for(e=4;e<=s;e++)t=e,n.push([t,t+(s-1),t+(2*s-2),t+(3*s-3)]),n.push([t+s,t+(2*s-1),t+(3*s-2),t+(4*s-3)]),n.push([t+2*s,t+(3*s-1),t+(4*s-2),t+(5*s-3)]);console.log(n)}(),$(".element").each(function(e){$(this).attr("data-element",e+1),$(this).append(e+1),u[e+1]="empty"}),$("[data-restart-game-first-player]").click(function(){alert("Game restarted. First player step!"),l="player",$(".active").removeClass("active-player").removeClass("active-ai").removeClass("active"),$(".element").each(function(e){u[e+1]="empty"})}),$("[data-restart-game-first-ai]").click(function(){alert("Game restarted. First AI step!"),l="ai",$(".active").removeClass("active-player").removeClass("active-ai").removeClass("active"),$(".element").each(function(e){u[e+1]="empty"}),a()}),$(".element").click(function(){if(!$(this).hasClass("active")){let e=!1;"player"===l&&(c=t($(this)),"Error"===c?alert(c):(c.addClass("active-player").addClass("active"),u[c.attr("data-element")]="active-player",l="ai",e=f("active-player")),e||a())}})});