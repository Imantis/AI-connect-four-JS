$(document).ready(function(){let l="player";const o=6,s=7,n=4;let c;var i=[],u=[];function f(t,e){let a=0,r=!1;if(i.forEach(e=>{if(e.forEach(e=>u[e]!==t?(a=0,null):void a++),4<=a)return r=!0,null}),r&&"future"!==e){let e=$("."+t);e.first().hasClass("active-player")?alert("Player win!"):e.first().hasClass("active-ai")&&alert("AI win!"),$(".element").addClass("active")}return r}function p(e){let t=e.data("element"),a=e,r;if(t>=o*s-o)return a;for(;t<=s*o;)if(t+=s,r=a,a=$("[data-element="+t+"]"),!a.length||a.hasClass("active"))return r;return"Error"}function a(){let e,t=!0;for(e=1;e<=s;e++)"empty"===u[e]&&(t=!1);if(!t){let e;var a,r;e="empty"===u[36]&&"empty"===u[37]&&"empty"===u[38]&&"empty"===u[39]&&"empty"===u[40]&&"empty"===u[41]&&"empty"===u[42]?(a=1,r=7,Math.floor(Math.random()*(r-a))+a):function(){console.log("Turn status on start "+l);var e=[];e=function(e){let t,a,r,i,n,l;for(t=1;t<=s;t++)if("empty"===u[t]&&(n=0,l=[t],n=v(l),e["turn_"+t]={weight:n,turn_combination:l,lev:1},0===n))for(a=1;a<=s;a++)if("empty"===u[a]&&(n=0,l=[t,a],n=v(l),e["turn_"+t+"_"+a]={weight:n,turn_combination:l,lev:2},0===n))for(r=1;r<=s;r++)if("empty"===u[r]&&(n=0,l=[t,a,r],n=v(l),e["turn_"+t+"_"+a+"_"+r]={weight:n,turn_combination:l,lev:3},0===n))for(i=1;i<=s;i++)"empty"===u[i]&&(n=0,l=[t,a,r,i],n=v(l),e["turn_"+t+"_"+a+"_"+r+"_"+i]={weight:n,turn_combination:l,lev:4});return e}(e);let t,a,r=0;console.log(u),console.log(e);let i;for(i=n-1;1<=i;i--)!function(t,a){let r,i,n;for(r in a){let e=[];if(i=a[r],i.lev===t&&0===i.weight){for(n=1;n<=s;n++)"active-ai"===u[n]||"active-player"===u[n]||void 0===u[n]||e.push(a[r+"_"+n].weight);e!==[]&&(a[r].weight=(t%2?function(e){return Math.min.apply(null,e)}:function(e){return Math.max.apply(null,e)})(e))}}}(i,e);for(t in console.log(e),e)a=e[t],1===a.lev&&1===a.weight&&(r=a.turn_combination[0]);if(0===r)for(t in e)a=e[t],1===a.lev&&0===a.weight&&(r=a.turn_combination[0]);if(0===r)for(t in e)a=e[t],1===a.lev&&-1===a.weight&&(r=a.turn_combination[0]);return r}(),c=p($("[data-element="+e+"]")),"Error"===c?alert(c):(c.addClass("active-ai").addClass("active"),l="player",f(u[c.attr("data-element")]="active-ai"))}}function v(e){var t=l,a=JSON.parse(JSON.stringify(u));let r,i,n=0;return e.forEach(e=>{c=function(e){let t=e,a;if(t>=o*s-o)return t;for(;t<=s*o;)if(a=t,t+=s,"active-ai"===u[t]||"active-player"===u[t]||void 0===u[t])return a;return"Error"}(e),"Error"===c||(r=!1,i=!1,l="player"===l?(u[c]="active-player",r=f("active-player","future"),"ai"):(u[c]="active-ai",i=f("active-ai","future"),"player"),n=!0===i?1:!0===r?-1:0)}),l=t,u=a,n}!function(){let e,t;for(e=0;e<o;e++)t=e*s,i.push([t+1,t+2,t+3,t+4]),i.push([t+2,t+3,t+4,t+5]),i.push([t+3,t+4,t+5,t+6]),i.push([t+4,t+5,t+6,t+7]);for(e=1;e<=s;e++)t=e,i.push([t,t+s,t+2*s,t+3*s]),i.push([t+s,t+2*s,t+3*s,t+4*s]),i.push([t+2*s,t+3*s,t+4*s,t+5*s]);for(e=1;e<=s-3;e++)t=e,i.push([t,t+(s+1),t+(2*s+2),t+(3*s+3)]),i.push([t+s,t+(2*s+1),t+(3*s+2),t+(4*s+3)]),i.push([t+2*s,t+(3*s+1),t+(4*s+2),t+(5*s+3)]);for(e=4;e<=s;e++)t=e,i.push([t,t+(s-1),t+(2*s-2),t+(3*s-3)]),i.push([t+s,t+(2*s-1),t+(3*s-2),t+(4*s-3)]),i.push([t+2*s,t+(3*s-1),t+(4*s-2),t+(5*s-3)]);console.log(i)}(),$(".element").each(function(e){$(this).attr("data-element",e+1),$(this).append(e+1),u[e+1]="empty"}),$("[data-restart-game-first-player]").click(function(){alert("Game restarted. First player step!"),l="player",$(".active").removeClass("active-player").removeClass("active-ai").removeClass("active"),$(".element").each(function(e){u[e+1]="empty"})}),$("[data-restart-game-first-ai]").click(function(){alert("Game restarted. First AI step!"),l="ai",$(".active").removeClass("active-player").removeClass("active-ai").removeClass("active"),$(".element").each(function(e){u[e+1]="empty"}),a()}),$(".element").click(function(){let e,t=!0;for(e=1;e<=s;e++)"empty"===u[e]&&(t=!1);if(!t&&!$(this).hasClass("active")){let e=!1;"player"===l&&(c=p($(this)),"Error"===c?alert(c):(c.addClass("active-player").addClass("active"),u[c.attr("data-element")]="active-player",l="ai",e=f("active-player")),e||a())}})});